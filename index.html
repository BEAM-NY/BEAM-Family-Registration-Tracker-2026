<!DOCTYPE html>
<html lang="en">
<head>
  <base target="_top">
  <title>BEAM Student Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f4f7f9; padding: 20px; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; transition: all 0.3s ease; }
    .hidden { display: none; }
    .card { border: none; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 600px; margin: auto; background: white; }
    .card-header { background: #004a99; color: white; padding: 20px; border-radius: 12px 12px 0 0; position: relative; }
    
    /* Language Toggle Styling */
    .lang-toggle { position: absolute; top: 15px; right: 15px; }
    .form-select-sm { background-color: rgba(255,255,255,0.9); border: none; font-weight: bold; color: #004a99; cursor: pointer; }

    .status-Submitted { color: #198754 !important; font-weight: bold; }
    .status-Not-Submitted { color: #dc3545 !important; font-weight: bold; }
    
    .section-box { border-radius: 8px; padding: 15px; margin-bottom: 15px; border-inline-start: 5px solid #ccc; background: #fff; }
    .section-forms { border-inline-start-color: #0d6efd; background: #f0f7ff; } 
    .section-uploads { border-inline-start-color: #fd7e14; background: #fff8f0; } 

    .section-title { font-weight: bold; color: #555; margin-bottom: 8px; font-size: 0.95rem; text-transform: uppercase; letter-spacing: 0.5px; }
    .btn-action { margin-top: 5px; border-radius: 6px; font-weight: 600; font-size: 0.85rem; padding: 8px 12px; }
    .table td { padding: 10px 8px; border-bottom: 1px solid #e0e0e0; vertical-align: middle; }
    .doc-name { color: #444; font-size: 0.95rem; }
    .doc-link { text-decoration: none; color: #004a99; font-weight: 500; border-bottom: 1px dotted #004a99; }
    .doc-link:hover { color: #002a5c; border-bottom: 1px solid #002a5c; }
    
    .success-banner { background: #d1e7dd; color: #0f5132; border: 1px solid #badbcc; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center; font-weight: bold; }
    
    /* Arabic RTL Support */
    body[dir="rtl"] { text-align: right; }
    body[dir="rtl"] .text-end { text-align: left !important; }
  </style>
</head>
<body>

  <div id="searchBox" class="card p-0">
    <div class="card-header">
      <div class="lang-toggle">
        <select id="langSelect" class="form-select form-select-sm" onchange="changeLanguage()">
          <option value="en">ğŸ‡ºğŸ‡¸ English</option>
          <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
          <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
          <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
        </select>
      </div>

      <h3 class="mb-1 mt-2" id="t-title">BEAM Student Portal</h3>
      <p class="mb-0 small" id="t-subtitle">Check your registration progress and missing forms here</p>
    </div>
    <div class="card-body p-4">
      <div class="mb-3">
        <label class="form-label fw-bold" id="t-dob">Student Birthdate</label>
        <input type="date" id="dob" class="form-control">
      </div>
      <div class="mb-4">
        <label class="form-label fw-bold" id="t-email">Email</label>
        <input type="email" id="email" class="form-control" placeholder="guardian@email.com">
      </div>
      <button onclick="runSearch()" id="btn" class="btn btn-primary w-100 fw-bold py-2 shadow-sm">Check Status</button>
      
      <div id="error" class="alert alert-warning mt-3 text-center hidden" style="font-size: 0.9rem;"></div>
    </div>
  </div>

  <div id="results" class="hidden">
    <div class="card p-0">
      <div class="card-header">
         <div class="lang-toggle">
          <select id="langSelectResult" class="form-select form-select-sm" onchange="syncLang(this)">
            <option value="en">ğŸ‡ºğŸ‡¸ English</option>
            <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
            <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
            <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
          </select>
        </div>
        <h3 class="mb-1 mt-2" id="t-res-title">Student Portal</h3>
      </div>
      <div class="card-body p-4">
        <div id="content"></div>
        <button onclick="resetSearch()" id="t-back" class="btn btn-link w-100 mt-3 text-decoration-none">â† Search Another Student</button>
      </div>
    </div>
  </div>

  <script>
    // â¬‡ï¸ YOUR SCRIPT URL â¬‡ï¸
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwNBzYcPxE3U-rTGKSqU9IgTYdjJP2glEXsnBMWmx3gQKA08OfaXNK9VaXGkz1U4zzx/exec";

    // --- TRANSLATION DATABASE ---
    const TRANSLATIONS = {
      en: {
        title: "BEAM Student Portal",
        subtitle: "Check your registration progress and missing forms here",
        dob: "Student Birthdate",
        email: "Email",
        btnCheck: "Check Status",
        btnSearching: "Searching...",
        errorConn: "Connection Issue. We couldn't verify automatically.",
        errorNoStudent: "No matching student found. Please check your details.",
        manualBtn: "Launch Secure Portal â†—",
        statusFor: "Status for",
        success: "ğŸ‰ Registration is complete!",
        timestamp: "Status as of",
        sectForms: "Registration Forms",
        sectUploads: "Document Uploads",
        groupedForms: "Student Information and Consent Forms",
        btnForms: "Complete Forms Now",
        btnUploads: "Upload Missing Documents",
        btnBack: "â† Search Another Student",
        submitted: "Submitted",
        notSubmitted: "Not Submitted",
        docs: {
          "Parent Med": "Parent Medical Release",
          "Phys Med": "Physician's Medical Release",
          "Meningitis": "Meningitis Form",
          "Report Card": "7th Grade Report Card",
          "Immuno": "Immunization Record",
          "Ins Front": "Insurance Card (Front)",
          "Ins Back": "Insurance Card (Back)"
        }
      },
      es: {
        title: "Portal Estudiantil BEAM",
        subtitle: "Verifique su progreso de registro y formularios faltantes",
        dob: "Fecha de Nacimiento del Estudiante",
        email: "Correo ElectrÃ³nico",
        btnCheck: "Verificar Estado",
        btnSearching: "Buscando...",
        errorConn: "Problema de conexiÃ³n. No pudimos verificar automÃ¡ticamente.",
        errorNoStudent: "No se encontrÃ³ ningÃºn estudiante. Verifique sus datos.",
        manualBtn: "Abrir Portal Seguro â†—",
        statusFor: "Estado de",
        success: "ğŸ‰ Â¡El registro estÃ¡ completo!",
        timestamp: "Estado al",
        sectForms: "Formularios de Registro",
        sectUploads: "Carga de Documentos",
        groupedForms: "InformaciÃ³n del Estudiante y Consentimientos",
        btnForms: "Completar Formularios Ahora",
        btnUploads: "Subir Documentos Faltantes",
        btnBack: "â† Buscar Otro Estudiante",
        submitted: "Enviado",
        notSubmitted: "No Enviado",
        docs: {
          "Parent Med": "AutorizaciÃ³n MÃ©dica de Padres",
          "Phys Med": "AutorizaciÃ³n MÃ©dica del MÃ©dico",
          "Meningitis": "Formulario de Meningitis",
          "Report Card": "Boleta de Calificaciones (7Âº Grado)",
          "Immuno": "Registro de InmunizaciÃ³n",
          "Ins Front": "Tarjeta de Seguro (Frente)",
          "Ins Back": "Tarjeta de Seguro (Dorso)"
        }
      },
      zh: {
        title: "BEAM å­¦ç”Ÿé—¨æˆ·",
        subtitle: "åœ¨æ­¤æŸ¥çœ‹æ‚¨çš„æ³¨å†Œè¿›åº¦å’Œç¼ºå¤±çš„è¡¨æ ¼",
        dob: "å­¦ç”Ÿå‡ºç”Ÿæ—¥æœŸ",
        email: "ç”µå­é‚®ä»¶",
        btnCheck: "æŸ¥çœ‹çŠ¶æ€",
        btnSearching: "æœç´¢ä¸­...",
        errorConn: "è¿æ¥é—®é¢˜ã€‚æˆ‘ä»¬æ— æ³•è‡ªåŠ¨éªŒè¯ã€‚",
        errorNoStudent: "æœªæ‰¾åˆ°åŒ¹é…çš„å­¦ç”Ÿã€‚è¯·æ£€æŸ¥æ‚¨çš„è¯¦ç»†ä¿¡æ¯ã€‚",
        manualBtn: "å¯åŠ¨å®‰å…¨é—¨æˆ· â†—",
        statusFor: "çŠ¶æ€ï¼š",
        success: "ğŸ‰ æ³¨å†Œå·²å®Œæˆï¼",
        timestamp: "çŠ¶æ€æˆªè‡³",
        sectForms: "æ³¨å†Œè¡¨æ ¼",
        sectUploads: "æ–‡æ¡£ä¸Šä¼ ",
        groupedForms: "å­¦ç”Ÿä¿¡æ¯å’ŒåŒæ„ä¹¦",
        btnForms: "ç«‹å³å¡«å†™è¡¨æ ¼",
        btnUploads: "ä¸Šä¼ ç¼ºå¤±æ–‡æ¡£",
        btnBack: "â† æœç´¢å¦ä¸€åå­¦ç”Ÿ",
        submitted: "å·²æäº¤",
        notSubmitted: "æœªæäº¤",
        docs: {
          "Parent Med": "å®¶é•¿åŒ»ç–—æˆæƒä¹¦",
          "Phys Med": "åŒ»ç”ŸåŒ»ç–—æˆæƒä¹¦",
          "Meningitis": "è„‘è†œç‚è¡¨æ ¼",
          "Report Card": "ä¸ƒå¹´çº§æˆç»©å•",
          "Immuno": "å…ç–«æ¥ç§è®°å½•",
          "Ins Front": "ä¿é™©å¡ï¼ˆæ­£é¢ï¼‰",
          "Ins Back": "ä¿é™©å¡ï¼ˆèƒŒé¢ï¼‰"
        }
      },
      ar: {
        title: "Ø¨ÙˆØ§Ø¨Ø© Ø·Ù„Ø§Ø¨ BEAM",
        subtitle: "ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙ‚Ø¯Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø© Ù‡Ù†Ø§",
        dob: "ØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯ Ø§Ù„Ø·Ø§Ù„Ø¨",
        email: "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
        btnCheck: "Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø©",
        btnSearching: "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...",
        errorConn: "Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù‚Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.",
        errorNoStudent: "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø·Ø§Ù„Ø¨ Ù…Ø·Ø§Ø¨Ù‚. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.",
        manualBtn: "ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¢Ù…Ù†Ø© â†—",
        statusFor: "Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù€",
        success: "ğŸ‰ Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„!",
        timestamp: "Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ø¹ØªØ¨Ø§Ø±Ù‹Ø§ Ù…Ù†",
        sectForms: "Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
        sectUploads: "ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª",
        groupedForms: "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆÙ†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©",
        btnForms: "Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¢Ù†",
        btnUploads: "ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©",
        btnBack: "â† Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨ Ø¢Ø®Ø±",
        submitted: "ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„",
        notSubmitted: "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„",
        docs: {
          "Parent Med": "Ø§Ù„Ø¥ÙØ±Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠ Ù…Ù† Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ†",
          "Phys Med": "Ø§Ù„Ø¥ÙØ±Ø§Ø¬ Ø§Ù„Ø·Ø¨ÙŠ Ù…Ù† Ø§Ù„Ø·Ø¨ÙŠØ¨",
          "Meningitis": "Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙ‡Ø§Ø¨ Ø§Ù„Ø³Ø­Ø§ÙŠØ§",
          "Report Card": "ØªÙ‚Ø±ÙŠØ± Ø¯Ø±Ø¬Ø§Øª Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¨Ø¹",
          "Immuno": "Ø³Ø¬Ù„ Ø§Ù„ØªØ·Ø¹ÙŠÙ…Ø§Øª",
          "Ins Front": "Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ£Ù…ÙŠÙ† (Ø§Ù„Ø£Ù…Ø§Ù…)",
          "Ins Back": "Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ£Ù…ÙŠÙ† (Ø§Ù„Ø®Ù„Ù)"
        }
      }
    };

    let currentLang = 'en';
    let currentResults = null; // Store results to re-render on lang change

    function syncLang(el) {
      document.getElementById('langSelect').value = el.value;
      document.getElementById('langSelectResult').value = el.value;
      changeLanguage();
    }

    function changeLanguage() {
      currentLang = document.getElementById('langSelect').value;
      const t = TRANSLATIONS[currentLang];
      
      // RTL Support for Arabic
      document.body.dir = (currentLang === 'ar') ? 'rtl' : 'ltr';

      // Update Static Labels
      document.getElementById('t-title').innerText = t.title;
      document.getElementById('t-res-title').innerText = t.title;
      document.getElementById('t-subtitle').innerText = t.subtitle;
      document.getElementById('t-dob').innerText = t.dob;
      document.getElementById('t-email').innerText = t.email;
      document.getElementById('btn').innerText = t.btnCheck;
      document.getElementById('t-back').innerText = t.btnBack;

      // Re-render results if they exist
      if (currentResults) render(currentResults);
    }

    function resetSearch() {
      document.getElementById('dob').value = '';
      document.getElementById('email').value = '';
      document.getElementById('results').classList.add('hidden');
      document.getElementById('searchBox').classList.remove('hidden');
      document.getElementById('content').innerHTML = '';
      currentResults = null;
    }

    window.receiveData = function(results) {
      const scriptTag = document.getElementById('jsonp_loader');
      if(scriptTag) scriptTag.remove(); 
      currentResults = results;
      render(results);
    };

    function manualFallback() {
      const dob = document.getElementById('dob').value;
      const email = document.getElementById('email').value;
      const target = `${SCRIPT_URL}?dob=${encodeURIComponent(dob)}&email=${encodeURIComponent(email)}`;
      const chooserUrl = `https://accounts.google.com/AccountChooser?continue=${encodeURIComponent(target)}`;
      window.open(chooserUrl, '_blank');
    }

    function runSearch() {
      const dob = document.getElementById('dob').value;
      const email = document.getElementById('email').value;
      const btn = document.getElementById('btn');
      const errBox = document.getElementById('error');
      const t = TRANSLATIONS[currentLang];
      
      if(!dob || !email) { alert("Please enter both DOB and Email."); return; }
      
      btn.disabled = true;
      btn.innerText = t.btnSearching;
      errBox.classList.add('hidden');

      const oldScript = document.getElementById('jsonp_loader');
      if(oldScript) oldScript.remove();

      const script = document.createElement('script');
      script.id = 'jsonp_loader';
      script.setAttribute('crossorigin', 'anonymous');
      script.src = `${SCRIPT_URL}?callback=receiveData&dob=${encodeURIComponent(dob)}&email=${encodeURIComponent(email)}`;
      
      script.onerror = function() {
        btn.disabled = false;
        btn.innerText = t.btnCheck;
        errBox.innerHTML = `<strong>${t.errorConn}</strong><br><button onclick="manualFallback()" class="btn btn-dark btn-sm fw-bold w-100 mt-2">${t.manualBtn}</button>`;
        errBox.classList.remove('hidden');
      };

      document.body.appendChild(script);
    }

    function render(results) {
      const t = TRANSLATIONS[currentLang];
      document.getElementById('btn').disabled = false;
      document.getElementById('btn').innerText = t.btnCheck;

      if (!results || results.length === 0) {
        document.getElementById('error').innerHTML = t.errorNoStudent;
        document.getElementById('error').classList.remove('hidden');
        document.getElementById('error').classList.remove('alert-warning');
        document.getElementById('error').classList.add('text-danger');
        return;
      }

      const today = new Date();
      const dateStr = (today.getMonth() + 1) + '/' + today.getDate() + '/' + today.getFullYear();
      let html = '';

      results.forEach(s => {
        const surveyItems = ["Liability Waiver", "Media Release", "Code of Conduct", "Data Consent", "Attendance"];
        const consentData = s.details.filter(d => surveyItems.includes(d.name));
        const documentData = s.details.filter(d => !surveyItems.includes(d.name));

        const missingConsents = consentData.filter(d => d.status !== "Submitted").length;
        const consentGroupStatus = missingConsents === 0 ? t.submitted : t.notSubmitted;
        const consentGroupClass = missingConsents === 0 ? "status-Submitted" : "status-Not-Submitted";

        const missingDocs = documentData.filter(d => d.status !== "Submitted").length;
        const isFullyComplete = (missingConsents === 0 && missingDocs === 0);

        html += `<h4 class="text-primary fw-bold text-center mb-1">${t.statusFor} ${s.firstName}</h4>`;
        html += `<div class="text-center mb-3"><span class="badge bg-secondary rounded-pill">${s.program}</span></div>`;

        if (isFullyComplete) {
           html += `<div class="success-banner">${t.success}</div>`;
        }

        html += `<p class="timestamp text-center">${t.timestamp}: ${dateStr}</p>`;

        // SECTION 1: CONSENT FORMS
        html += `<div class="section-box section-forms">`;
        html += `<div class="section-title">${t.sectForms}</div>`;
        html += `<table class="table table-sm mb-0">`;
        html += `<tr>
                   <td class="doc-name">${t.groupedForms}</td>
                   <td class="${consentGroupClass} text-end">${consentGroupStatus}</td>
                 </tr>`;
        html += `</table>`;
        if (missingConsents > 0) {
           html += `<a href="https://www.surveymonkey.com/r/R3PW5S8" target="_blank" class="btn btn-primary btn-action w-100 mt-2">${t.btnForms}</a>`;
        }
        html += `</div>`;

        // SECTION 2: DOCUMENTS
        html += `<div class="section-box section-uploads">`;
        html += `<div class="section-title">${t.sectUploads}</div>`;
        html += `<table class="table table-sm mb-0">`;
        
        documentData.forEach(d => {
            let displayName = t.docs[d.name] || d.name; // Translate doc name
            const statusClass = d.status === 'Submitted' ? 'status-Submitted' : 'status-Not-Submitted';
            const statusText = d.status === 'Submitted' ? t.submitted : t.notSubmitted; // Translate status

            // Hyperlinks
            if (d.name === "Parent Med") {
              displayName = `<a href="https://drive.google.com/file/d/1-KZJNbLbuSCUiDbQdtnxb_-jcrZT2JRe/view?usp=drive_link" target="_blank" class="doc-link">${displayName}</a>`;
            } else if (d.name === "Phys Med") {
              displayName = `<a href="https://drive.google.com/file/d/1hFlb-ae7Vl5kGwakqwoYF-TB4nQOynmY/view?usp=drive_link" target="_blank" class="doc-link">${displayName}</a>`;
            }

            html += `<tr><td class="doc-name">${displayName}</td><td class="${statusClass} text-end">${statusText}</td></tr>`;
        });
        html += `</table>`;

        if (missingDocs > 0) {
           html += `<a href="https://www.surveymonkey.com/r/9GYMKBM" target="_blank" class="btn btn-warning btn-action w-100 mt-2 text-dark">${t.btnUploads}</a>`;
        }
        html += `</div><hr class="my-4">`;
      });

      document.getElementById('content').innerHTML = html;
      document.getElementById('searchBox').classList.add('hidden');
      document.getElementById('results').classList.remove('hidden');
    }
  </script>
</body>
</html>
